var icons = ["icon", "ui large vertical inverted labeled", "close", "inverted circular red awesome download cloud", "icon list layout", "icon item", "left arrow", "icon item", "right arrow", "popup designer", "basic paint", "popup developer", "terminal", "popup", "icon github", "icon list layout", "ui basic labeled", "book", "icon example", "icon code", "archive", "attachment", "browser", "bug", "calendar", "cart", "certificate", "chat", "cloud", "code", "comment", "dashboard", "desktop", "empty calendar", "external url", "external url sign", "file", "file outline", "folder", "folder open", "folder open outline", "folder outline", "help", "home", "inbox", "info", "info letter", "legal", "location arrow", "mail", "mail outline", "map", "map marker", "mobile", "music", "outline chat", "outline comment", "payment", "photo", "qr code", "question", "rss", "rss sign", "setting", "settings", "signal", "sitemap", "table", "tablet", "tag", "tags", "tasks", "terminal", "text file", "text file outline", "time", "trash", "url", "user", "users", "video", "archive", "attachment", "browser", "bug", "calendar", "cart", "certificate", "chat", "cloud", "code", "comment", "dashboard", "desktop", "empty calendar", "external url", "external url sign", "file", "file outline", "folder", "folder open", "folder open outline", "folder outline", "help", "home", "inbox", "info", "info letter", "legal", "location arrow", "mail", "mail outline", "map", "map marker", "mobile", "music", "outline chat", "outline comment", "payment", "photo", "qr code", "question", "rss", "rss sign", "setting", "settings", "signal", "sitemap", "table", "tablet", "tag", "tags", "tasks", "terminal", "text file", "text file outline", "time", "trash", "url", "user", "users", "video", "icon example", "icon code", "add", "add sign", "add sign box", "adjust", "bookmark empty", "bookmark", "cloud download", "cloud upload", "collapse", "crop", "download disk", "download", "edit", "edit sign", "empty flag", "exchange", "expand", "filter", "flag", "fork code", "forward mail", "fullscreen", "hide", "level down", "level up", "off", "refresh", "remove circle", "remove", "remove sign", "reorder", "reply all mail", "reply mail", "retweet", "save", "screenshot", "search", "share", "share sign", "sign in", "sign out", "tint", "unhide", "upload disk", "upload", "add", "add sign box", "add sign", "adjust", "bookmark empty", "bookmark", "cloud download", "cloud upload", "collapse", "crop", "download disk", "download", "edit", "edit sign", "empty flag", "exchange", "expand", "filter", "flag", "fork code", "forward mail", "fullscreen", "hide", "level down", "level up", "off", "refresh", "remove circle", "remove", "remove sign", "reorder", "reply all mail", "reply mail", "retweet", "save", "screenshot", "search", "share", "share sign", "sign in", "sign out", "tint", "unhide", "upload disk", "upload", "icon example", "icon code", "block layout", "column layout", "grid layout", "list layout", "resize full", "resize horizontal", "resize small", "resize vertical", "sort alphabet descending", "sort alphabet", "sort ascending", "sort attributes descending", "sort attributes", "sort descending", "sort", "sort order descending", "sort order", "zoom in", "zoom out", "block layout", "column layout", "grid layout", "list layout", "resize full", "resize horizontal", "resize small", "resize vertical", "sort alphabet descending", "sort alphabet", "sort ascending", "sort attributes descending", "sort attributes", "sort descending", "sort", "sort order descending", "sort order", "zoom in", "zoom out", "icon example", "icon code", "align center", "align justify", "align left", "align right", "bold", "copy", "cut", "ellipsis horizontal", "ellipsis vertical", "font", "indent left", "indent right", "italic", "list", "move", "ordered list", "paste", "print", "quote left", "quote right", "strikethrough", "subscript", "superscript", "text height", "text width", "underline", "undo", "unlink", "unordered list", "align center", "align justify", "align left", "align right", "bold", "copy", "cut", "ellipsis horizontal", "ellipsis vertical", "font", "indent left", "indent right", "italic", "list", "move", "ordered list", "paste", "print", "quote left", "quote right", "strikethrough", "subscript", "superscript", "text height", "text width", "underline", "undo", "unlink", "unordered list", "icon example", "icon code", "backward", "eject", "fast backward", "fast forward", "mute", "pause", "play circle", "play", "play sign", "shuffle", "repeat", "step backward", "step forward", "stop", "unmute", "volume down", "volume off", "volume up", "backward", "eject", "fast backward", "fast forward", "mute", "pause", "play circle", "play", "play sign", "shuffle", "repeat", "step backward", "step forward", "stop", "unmute", "volume down", "volume off", "volume up", "icon example", "icon code", "ambulance", "anchor", "barcode", "lab", "beer", "bell outline", "bolt", "book", "briefcase", "building", "bullhorn", "bullseye", "camera", "camera retro", "coffee", "doctor", "eraser", "female", "fighter jet", "fire extinguisher", "fire", "flag checkered", "food", "gamepad", "gift", "glass", "globe", "hdd", "headphones", "hospital", "key", "keyboard", "laptop", "leaf", "lemon", "lightbulb", "magic", "magnet", "male", "medkit", "money", "moon", "pencil", "phone", "phone sign", "pin", "plane", "puzzle piece", "road", "rocket", "shield", "stethoscope", "suitcase", "sun", "ticket", "trophy", "truck", "umbrella", "wrench", "ambulance", "anchor", "barcode", "lab", "beer", "bell outline", "bolt", "book", "briefcase", "building", "bullhorn", "bullseye", "camera", "camera retro", "coffee", "doctor", "eraser", "female", "fighter jet", "fire extinguisher", "fire", "flag checkered", "food", "gamepad", "gift", "glass", "globe", "hdd", "headphones", "hospital", "key", "keyboard", "laptop", "leaf", "lemon", "lightbulb", "magic", "magnet", "male", "medkit", "money", "moon", "pencil", "phone", "phone sign", "pin", "plane", "puzzle piece", "road", "rocket", "shield", "stethoscope", "suitcase", "sun", "ticket", "trophy", "truck", "umbrella", "wrench", "icon example", "icon code", "ban circle", "checkmark", "checkmark sign", "minus checkbox", "empty checkbox", "checked checkbox", "exclamation", "attention", "frown", "heart empty", "heart", "loading", "lock", "meh", "ok circle", "ok sign", "smile", "star empty", "star half empty", "star half", "star", "thumbs down", "thumbs down outline", "thumbs up", "thumbs up outline", "unlock alternate", "unlock", "warning", "ban circle", "checkmark", "minus checkmark", "checkmark sign", "empty checkbox", "checked checkbox", "exclamation", "exclamation sign", "frown", "heart empty", "heart", "loading", "lock", "meh", "ok circle", "ok", "ok sign", "smile", "star empty", "star half empty", "star half", "star", "thumbs down", "thumbs down outline", "thumbs up", "thumbs up outline", "unlock alternate", "unlock", "warning", "icon example", "icon code", "angle down", "angle left", "angle right", "angle up", "arrow box down", "arrow box right", "arrow box up", "down", "left", "right", "up", "asterisk", "triangle down", "triangle left", "triangle right", "triangle up", "arrow down", "arrow left", "arrow right", "arrow up", "arrow sign down", "arrow sign left", "arrow sign right", "arrow sign up", "circle left", "circle right", "circle up", "circle down", "circle blank", "circle", "double angle down", "double angle left", "double angle right", "double angle up", "hand down", "hand left", "hand right", "hand up", "long arrow down", "long arrow left", "long arrow right", "long arrow up", "minus", "minus sign alternate", "minus sign", "sign", "angle down", "angle left", "angle right", "angle up", "arrow box down", "arrow box right", "arrow box up", "arrow down", "arrow left", "arrow right", "arrow up", "asterisk", "triangle down", "triangle left", "triangle right", "triangle up", "arrow down", "arrow left", "arrow right", "arrow up", "arrow sign down", "arrow sign left", "arrow sign right", "arrow sign up", "arrow up", "circle arrow left", "circle arrow right", "circle arrow up", "circle blank", "circle down arrow", "circle", "double angle down", "double angle left", "double angle right", "double angle up", "hand down", "hand left", "hand right", "hand up", "long arrow down", "long arrow left", "long arrow right", "long arrow up", "minus", "minus sign alternate", "minus sign", "sign", "icon example", "icon code", "dollar", "euro", "pound", "rupee", "won", "yen", "yuan", "dollar", "euro", "pound", "rupee", "won", "yen", "yuan", "icon example", "icon code", "adn", "android", "apple", "bitbucket", "bitbucket sign", "bitcoin", "css3", "dribbble", "dropbox", "facebook", "facebook sign", "facetime video", "flickr", "foursquare", "github alternate", "github", "github sign", "gittip", "google plus", "google plus sign", "h sign", "html5", "instagram", "linkedin", "linkedin sign", "linux", "maxcdn", "pinterest", "pinterest sign", "renren", "skype", "stackexchange", "trello", "tumblr", "tumblr sign", "twitter", "twitter sign", "vk", "weibo", "windows", "xing", "xing sign", "youtube", "youtube play", "youtube sign", "adn", "android", "apple", "bitbucket", "bitbucket sign", "bitcoin", "css3", "dribbble", "dropbox", "facebook", "facebook sign", "facetime video", "flickr", "foursquare", "github alternate", "github", "github sign", "gittip", "google plus", "google plus sign", "h sign", "html5", "instagram", "linkedin", "linkedin sign", "linux", "maxcdn", "pinterest", "pinterest sign", "renren", "skype", "stackexchange", "trello", "tumblr", "tumblr sign", "twitter", "twitter sign", "vk", "weibo", "windows", "xing", "xing sign", "youtube", "youtube play", "youtube sign", "icon example", "icon code", "attachment basic", "barcode basic", "bookmark basic", "cart basic", "chart basic", "bar chart basic", "pie chart basic", "date basic", "doc basic", "docs basic", "email basic", "folder basic", "open folder basic", "home basic", "mail basic", "photo basic", "photos basic", "search basic", "setting basic", "settings basic", "tag basic", "tags basic", "time basic", "top list basic", "trash basic", "community basic", "url basic", "user basic", "users basic", "chat basic", "attachment basic", "barcode basic", "bookmark basic", "cart basic", "chart basic", "bar chart basic", "pie chart basic", "date basic", "doc basic", "docs basic", "email basic", "folder basic", "open folder basic", "home basic", "mail basic", "photo basic", "photos basic", "search basic", "setting basic", "settings basic", "tag basic", "tags basic", "time basic", "top list basic", "trash basic", "community basic", "url basic", "user basic", "users basic", "chat basic", "icon example", "icon code", "trophy basic", "cloud basic", "flight basic", "gift basic", "dollar basic", "lab basic", "rss basic", "trophy basic", "cloud basic", "flight basic", "gift basic", "dollar basic", "lab basic", "rss basic", "icon example", "icon code", "add user basic", "block basic", "hide basic", "unhide basic", "lock basic", "unlock basic", "flag basic", "cancel basic", "close basic", "close basic", "check basic", "edit basic", "open basic", "export basic", "forward basic", "upload basic", "like basic", "dislike basic", "pin basic", "star basic", "empty star basic", "half star basic", "print basic", "comment basic", "add user basic", "block basic", "hide basic", "unhide basic", "lock basic", "unlock basic", "flag basic", "cancel basic", "close basic", "close basic", "check basic", "edit basic", "open basic", "export basic", "forward basic", "upload basic", "like basic", "dislike basic", "pin basic", "star basic", "empty star basic", "half star basic", "print basic", "comment basic", "icon example", "icon code", "content basic", "grid layout basic", "block layout basic", "list layout basic", "resize full basic", "resize horizontal basic", "resize small basic", "resize vertical basic", "zoom in basic", "zoom out basic", "content basic", "grid layout basic", "block layout basic", "list layout basic", "resize full basic", "resize horizontal basic", "resize small basic", "resize vertical basic", "zoom in basic", "zoom out basic", "icon example", "icon code", "eject basic", "fast-forward basic", "pause basic", "play basic", "to-end basic", "to-start basic", "forward basic", "shuffle basic", "clockwise basic", "counter clockwise basic", "eject basic", "fast-forward basic", "pause basic", "play basic", "to-end basic", "to-start basic", "forward basic", "shuffle basic", "clockwise basic", "counter clockwise basic", "icon example", "icon code", "book basic", "calendar basic", "color basic", "desk globe basic", "fire basic", "globe basic", "headphones basic", "id basic", "idea basic", "lightning basic", "money basic", "paint basic", "book basic", "calendar basic", "color basic", "desk globe basic", "fire basic", "globe basic", "headphones basic", "id basic", "idea basic", "lightning basic", "money basic", "paint basic", "icon example", "icon code", "cancel circle basic", "asterisk basic", "attention circle basic", "attention basic", "empty heart basic", "heart basic", "thumbs down basic", "thumbs up basic", "terminal basic", "direction basic", "location basic", "help basic", "info basic", "mic basic", "off basic", "add basic", "cancel circle basic", "asterisk basic", "attention circle basic", "attention basic", "empty heart basic", "heart basic", "thumbs down basic", "thumbs up basic", "terminal basic", "direction basic", "location basic", "help basic", "info basic", "mic basic", "off basic", "add basic", "icon example", "icon code", "left arrow basic", "left triangle basic", "left basic", "right basic", "right triangle basic", "right arrow basic", "up basic", "up triangle basic", "up arrow basic", "down arrow basic", "down triangle basic", "down basic", "cube basic", "minus basic", "plus basic", "left arrow basic", "left triangle basic", "left basic", "right basic", "right triangle basic", "right arrow basic", "up basic", "up triangle basic", "up arrow basic", "down arrow basic", "down triangle basic", "down basic", "cube basic", "minus basic", "plus basic", "icon example", "icon code", "facebook basic", "twitter basic", "github basic", "icon code", "disabled users", "icon code", "small home", "home", "large home", "big home", "huge home", "massive home", "icon code", "close", "help circle", "icon code", "horizontally flipped cloud", "vertically flipped cloud", "icon code", "clockwise rotated cloud", "counterclockwise rotated cloud", "icon code", "circular users", "circular teal users", "circular inverted users", "circular inverted teal users", "icon code", "square users", "square teal users", "square inverted users", "square inverted teal users", "icon code", "black users", "blue user", "red users", "green user", "purple chat", "teal comment", "icon code", "inverted black users", "inverted blue user", "inverted red users", "inverted green user", "inverted purple chat", "inverted teal comment"];

Projects = new Meteor.Collection('projects');

Meteor.methods({
  createProject: function(name, description, team)
  {
    var slug = URLify2(name);
    var counter = 1;
    while(Projects.find({slug: slug}).fetch().length > 0)
    {
      slug = URLify2(name+" "+counter);
      counter++;
    }
    var project = Projects.insert({
      name: name,
      slug: slug,
      icon: icons[Math.floor(Math.random()*icons.length)-1],
      description: description,
      owner: Meteor.user().username,
      team: team,
      createdat: moment().unix(),
      updatedat: moment().unix()
    });
    Meteor.call('createUpdate', 'fork code', "created a new project called </strong>"+name+"</strong>", project._id, 'project')
    return project;
  },
  deleteProject: function(project)
  {
    var name = project.name;
    if(project.owner == Meteor.user().username)
    {
      Projects.remove({_id: project._id});
      Meteor.call('createUpdate', 'trash', "deleted the project <strong>"+name+"</strong>");
    }
    else{
      toastr.error("You don't own this project!")
    }
  }
})